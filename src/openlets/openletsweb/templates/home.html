{% extends 'base.html' %}

{% block container %}
  <div class="content">

    <div class="row">
  {% block sidebar %}
  <div class="span3 fixed">
    <div class="well">
      <h5>Menu</h5>
      <ul class="unstyled">
        {% if notifications %}
        <li><a href="#notifications">Notifications</a></li>
	    {% endif %}
        <li><a href="#newtransaction">New Transaction</a></li>
        <li><a href="#recenttransactions">Recent Transactions</a></li>
        <li><a href="#balances">Balances</a></li>
        <li><a href="#export">Export</a></li>
      </ul>
	</div>
  </div>
  {% endblock %}

  <div class="span13 offset3">

  {% block messages %}
	{% if messages %}
	  {% for message in messages %}
	    <div class="alert-message {{ message.tags}}" data-alert="alert">
			<a class="close" href="#">Ã—</a>
			<p>{{ message }}</p>
		</div>
	  {% endfor %}
	{% endif %}
  {% endblock %}

  {% block content %}

  {% if notifications %}
  <a name="notifications"></a>
  <div>
    <h3>Notifications</h3>
	  {% for notification in notifications %}
	    <p>{{ notification }}</p>
	  {% endfor %}
  </div>
  {% endif %}

  <a name="newtransaction"></a>
  <div>
    <h3>New Transaction</h3>
	{% if pending_trans_records %}
	<h4>Pending Transactions</h4>

    <table class="zebra-striped">
	  <thead>
	    <tr>
		  <th>Type</th>
		  <th>Person</th>
		  <th>Amount</th>
		  <th>Time</th>
		  <th>Actions</th>
		</tr>
	  </thead>
	  <tbody>
	    {% for record in pending_trans_records %}
	    <tr>
		  <td>{{ record.targets_transaction_type|capfirst }}</td>
		  <td>{{ record.creator_person }}</td>
		  <td>{{ record.value_repr }}</td>
		  <td>{{ record.transaction_time}}</td>
		  <td class="link_container">
		  	<a href="{% url transaction_confirm record.id %}">confirm</a>
			<a href="{% url transaction_modify record.id %}">modify</a>
		  </td>
		</tr>
		{% endfor %}
	  </tbody>
    </table>
	{% endif %}

	<h4>Register a new transaction</h4>
	<form method="post" action="{% url transaction_new %}">
		{% csrf_token %}
		{{ new_transaction_form.as_p }}
		<div class="input">
		  <input type="submit" class="btn primary" value="Submit">
		</div>
	</form>

  </div>

  <a name="recenttransactions"></a>
  <div>
    <h3>Recent Transactions</h3>
  
    <table class="zebra-striped">
	  <thead>
	    <tr>
		  <th>Type</th>
		  <th>Status</th>
		  <th>Person</th>
		  <th>Amount</th>
		  <th>Time</th>
		  <th>Confirmed Time</th>
		</tr>
	  </thead>
	  <tbody>
	    {% for record in recent_trans_records %}
	    <tr>
		  <td>{{ record.transaction_type|capfirst }}</td>
		  <td>{{ record.status|capfirst }}</td>
		  <td>{{ record.target_person }}</td>
		  <td>{{ record.value_repr }}</td>
		  <td>{{ record.transaction_time}}</td>
		  <td>{{ record.transaction.time_confirmed }}</td>
		</tr>
		{% endfor %}
	  </tbody>
    </table>
  </div>

  <a name="balances"></a>
  <div>
    <h3>Balances</h3>
	<table class="zebra-striped">
	  <thead>
	  	<tr>
		  <th>Person</th>
		  <th>Amount</th>
		  <th>Last Change</th>
		  <th>Actions</th>
		</tr>
	  </thead>
	  <tbody>
	  	{% for balance in balances %}
		<tr>
		  <td>{{ balance.other_person }}</td>
		  <td>{{ balance.relative_value_repr }}</td>
		  <td>{{ balance.balance.time_updated }}</td>
		  <td>
		    <a href="{% url transaction_list %}?person={{ balance.other_person.id }}&currency={{ balance.balance.currency.id }}">History</a>
		  </td>
		</tr>
		{% endfor %}
	  </tbody>
	</table>
  </div>

  <a name="export"></a>
  <div>
    <h3>Export Data</h3>
	<p><a href="{% url export_data %}">Export</a> all your transfers and balances for your person records.</p>

  {% endblock %}
  </div>

    </div>
  </div>
{% endblock %}

